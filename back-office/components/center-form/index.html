<h1 class="title">{{ $ctrl.center.acronym }}</h1>

<button ng-if="$ctrl.loading" class="button is-loading is-rounded"></button>

<form ng-if="!$ctrl.loading">
  <div class="tabs is-boxed">
    <ul>
      <li ng-repeat="tab in $ctrl.tabs" ng-class="{'is-active': $ctrl.isActive(tab)}">
        <a ng-click="$ctrl.setTab(tab)">{{ tab.label }}</a>
      </li>
    </ul>
  </div>

  <section ng-repeat="tab in $ctrl.tabs" ng-if="$ctrl.tab === tab.id">

    <div ng-repeat="field in $ctrl.fields | filter:{ tab: tab.id }" class="field">
      <label class="label" for="field_{{ field.key }}">{{ field.label }}</label>
      <div class="control has-icons-left" ng-switch on="field.type">

        <textarea ng-switch-when="markdown" class="textarea"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]"></textarea>

        <input ng-switch-when="boolean" type="checkbox"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />

        <input ng-switch-when="number" type="number" class="input"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />

        <input ng-switch-when="email" type="email" class="input"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />
        <span ng-switch-when="email" class="icon is-small is-left">
          <i class="fa fa-envelope"></i>
        </span>

        <input ng-switch-when="url" type="url" class="input"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />
        <span ng-switch-when="url" class="icon is-small is-left">
          <i class="fa fa-link"></i>
        </span>

        <input ng-switch-when="tel" type="tel" class="input"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />
        <span ng-switch-when="tel" class="icon is-small is-left">
          <i class="fa fa-phone"></i>
        </span>

        <input ng-switch-when="person" type="text" class="input"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />
        <span ng-switch-when="person" class="icon is-small is-left">
          <i class="fa fa-user"></i>
        </span>

        <div ng-switch-when="array">

          <section class="section" ng-repeat="item in $ctrl.center[field.key]" class="field">
            <div ng-repeat="subField in field.fields" class="field">
              <label class="label">{{ subField.label }}</label>
              <input class="input" ng-model="item[subField.key]" />
            </div>
          </section>

          <button class="button">Ajouter</button>
        </div>

        <input ng-switch-default class="input"
          id="field_{{ field.key }}" ng-model="$ctrl.center[field.key]" />
        </span>
      </div>
    </div>

  </section>

  <section class="section">
    <div class="field is-grouped is-grouped-centered">
      <div class="control">
        <a class="button is-success" ng-click="$ctrl.submit()">
          <span class="icon is-small">
            <i class="fa fa-check"></i>
          </span>
          <span ng-if="!$ctrl.session.email">Proposer une modification de tous les onglets</span>
          <span ng-if="$ctrl.session.email">Enregistrer tous les onglets</span>
        </a>
      </div>
      <div class="control">
        <a class="button is-outlined" href="/centers">
          <span>Annuler</span>
        </a>
      </div>
    </div>

    <div class="field" ng-if="!$ctrl.session.email">
      <label class="label">Renseignez votre email si vous souhaitez être informé de la validation de votre modification:</label>
      <div class="control has-icons-left">
        <input class="input" type="email" placeholder="email" ng-model="$ctrl.email" />
        <span class="icon is-small is-left">
          <i class="fa fa-envelope"></i>
        </span>
      </div>
    </div>
  </section>
</form>
