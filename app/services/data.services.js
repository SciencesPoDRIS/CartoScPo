'use strict';

angular.module('bib.services')
.factory('dataService', function ($q, $http, fileService) {
  var url = './data/data.json?ver=' + Math.floor(Date.now() / 1000);
  var cache;

  return {

    get: function () {
      // TODO: not hardcoded URL
      return cache ? $q.resolve(cache) : $http.get('http://localhost:42000/api/export')
      .then(function(res) { return res.data })
      .then(function (data) {
        cache = data;
        return data;
      });
    }
  };
})
.factory('autocompleteService', function(dataService) {
  return {
    // all words are generated during CSV parsing
    // we can't really used the tokens generated by lunr
    // because they are truncated words (stems)
    getWords: function() {
      return dataService.get().then(function (data) {
        return data.words;
      });
    }
  };
})
;
